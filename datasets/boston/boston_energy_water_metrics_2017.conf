# Command line: cat boston_energy_water_metrics_2017.csv | bin/logstash -f boston_energy_water_metrics_2017.conf
# OR Command Line: tail -n +2 boston_energy_water_metrics_2017.csv | bin/logstash -f boston_energy_water_metrics_2017.conf


input {
	stdin {}
}

filter {
	csv {
		separator => ","
		columns => [
			"property_name",
			"reported",
			"property_type",
			"address",
			"zip_code",
			"gross_area_sqft",
			"site_eui_kbtu_sf",
			"energy_star_score",
			"energy_star_certified",
			"property_uses",
			"year_built",
			"ghg_emissions_mtco2e",
			"ghg_intesity_kgco2_sf",
			"total_site_energy",
			"percent_electricity",
			"percent_gas",
			"percent_steam",
			"water_intensity_gal_sf",
			"onsite_renewable_kwh",
      "user_submitted_info",
      "user_submitted_link",
      "tax_parcel",
      "years_reported"
		]
	}

	if [gross_area_sqft] == "" {
		mutate {
			remove_field => ["gross_area_sqft"]
			}
		}
	if [site_eui_kbtu_sf] == "" {
			 mutate{
			 remove_field => ["site_eui_kbtu_sf"]
		 }
	}
	if [energy_star_score] == "" {
			 mutate{
			 remove_field => ["energy_star_score"]
		 }
	}
	if [ghg_emissions_mtco2e] == "" {
			 mutate{
			 remove_field => ["ghg_emissions_mtco2e"]
		 }
	}
	if [ghg_intesity_kgco2_sf] == "" {
			 mutate{
			 remove_field => ["ghg_intesity_kgco2_sf"]
		 }
	}
	if [total_site_energy] == "" {
			 mutate{
			 remove_field => ["total_site_energy"]
		 }
	}
	if [percent_electricity] == "" {
			 mutate{
			 remove_field => ["percent_electricity"]
		 }
	}
	if [percent_gas] == "" {
			 mutate{
			 remove_field => ["percent_gas"]
		 }
	}
	if [percent_steam] == "" {
			 mutate{
			 remove_field => ["percent_steam"]
		 }
	}
	if [water_intensity_gal_sf] == "" {
			 mutate{
			 remove_field => ["water_intensity_gal_sf"]
		 }
	}
	if [onsite_renewable_kwh] == "" {
			 mutate{
			 remove_field => ["onsite_renewable_kwh"]
		 }
	}

mutate {
		convert => ["gross_area_sqft", "integer"]
		convert => ["site_eui_kbtu_sf", "float"]
		convert => ["energy_star_score", "integer"]
		convert => ["ghg_emissions_mtco2e", "float"]
		convert => ["ghg_intesity_kgco2_sf", "float"]
		convert => ["total_site_energy", "float"]
		convert => ["percent_electricity", "float"]
		convert => ["percent_gas", "float"]
		convert => ["percent_steam", "float"]
		convert => ["water_intensity_gal_sf", "float"]
		convert => ["onsite_renewable_kwh", "float"]
		remove_field => [ "message"]
	}
}

output {
	stdout { codec => dots }
	elasticsearch {
		hosts => "localhost:9400"
    user => "elastic"
    password => "Elastic2018!"
		index => "boston"
		document_type => "_doc"
		template => "./boston_energy_water_metrics_2017_template.json"
		template_name => "boston"
		template_overwrite => true
	}
}
